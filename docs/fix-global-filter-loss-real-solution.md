# ä¿®å¤ä»»åŠ¡ä¿®æ”¹æ—¶å…¨å±€è¿‡æ»¤ç¬¦å·ä¸¢å¤±é—®é¢˜

## é—®é¢˜æè¿°

å½“ç”¨æˆ·é€šè¿‡ä»¥ä¸‹æ“ä½œä¿®æ”¹ä»»åŠ¡æ—¶ï¼Œä»»åŠ¡ä¼šä¸¢å¤±å…¨å±€è¿‡æ»¤ç¬¦å·ï¼š
1. ç‚¹å‡»ä»»åŠ¡å¡ç‰‡å®Œæˆä»»åŠ¡ï¼ˆå¤é€‰æ¡†ï¼‰
2. åœ¨ç”˜ç‰¹å›¾ä¸­æ‹–æ‹½ä»»åŠ¡æ¡ä¿®æ”¹ä»»åŠ¡æ—¶é—´
3. ä»»ä½•å…¶ä»–é€šè¿‡ `updateTaskProperties` å‡½æ•°çš„ä»»åŠ¡ä¿®æ”¹

### é—®é¢˜ç°è±¡
- **åŸå§‹ä»»åŠ¡**ï¼š`- [ ] ğŸ¯ å®Œæˆé¡¹ç›®æ–‡æ¡£ ğŸ“… 2025-01-15`
- **ä¿®æ”¹å**ï¼š`- [ ] å®Œæˆé¡¹ç›®æ–‡æ¡£ ğŸ“… 2025-01-15` ï¼ˆå…¨å±€è¿‡æ»¤ç¬¦å· `ğŸ¯ ` ä¸¢å¤±ï¼‰

## æ ¹æœ¬åŸå› 

è™½ç„¶ `serializeTask` å‡½æ•°åœ¨ä»£ç ä¸­æœ‰æ·»åŠ å…¨å±€è¿‡æ»¤ç¬¦å·çš„é€»è¾‘ï¼Œä½†é—®é¢˜åœ¨äº**æ— æ³•æ­£ç¡®è·å–æ’ä»¶å®ä¾‹åŠå…¶è®¾ç½®**ï¼š

```typescript
// æ—§ä»£ç ä¸­è·å–æ’ä»¶çš„æ–¹å¼æœ‰é—®é¢˜
const plugin = (app as any).plugins?.plugins['obsidian-gantt-calendar'];
const globalFilter = plugin?.settings?.globalTaskFilter || '';
```

é—®é¢˜ï¼š
1. `(app as any).plugins?.plugins['obsidian-gantt-calendar']` çš„è®¿é—®è·¯å¾„å¯èƒ½ä¸å¯¹
2. å¦‚æœè·å–å¤±è´¥ï¼Œ`globalFilter` ä¼šæ˜¯ç©ºå­—ç¬¦ä¸²
3. æœ€ååºåˆ—åŒ–æ—¶å°±æ— æ³•æ·»åŠ å…¨å±€è¿‡æ»¤ç¬¦å·

## è§£å†³æ–¹æ¡ˆ

æ”¹è¿›æ’ä»¶å®ä¾‹çš„è·å–æ–¹å¼ï¼Œå¢åŠ å¤‡ç”¨è®¿é—®è·¯å¾„ï¼š

```typescript
// æ”¹è¿›åï¼šä½¿ç”¨åŒé‡æŸ¥è¯¢ç¡®ä¿èƒ½è·å–åˆ°æ’ä»¶å®ä¾‹
const ganttPlugin = (app as any).plugins?.plugins?.['obsidian-gantt-calendar'] || 
                    (app as any).plugins?.getPlugin?.('obsidian-gantt-calendar');
const globalFilter = ganttPlugin?.settings?.globalTaskFilter || '';
const taskStatuses = ganttPlugin?.settings?.taskStatuses || DEFAULT_TASK_STATUSES;
```

### æ”¹è¿›çš„å…³é”®ç‚¹

1. **åŒé‡æŸ¥è¯¢è·¯å¾„**
   - é¦–é€‰ï¼š`(app as any).plugins?.plugins?.['obsidian-gantt-calendar']`
   - å¤‡é€‰ï¼š`(app as any).plugins?.getPlugin?.('obsidian-gantt-calendar')`
   - è¿™æ ·å¯ä»¥å…¼å®¹ä¸åŒç‰ˆæœ¬ Obsidian çš„æ’ä»¶ç®¡ç†å™¨å®ç°

2. **é€šè¿‡é“¾å¼å¯é€‰æ“ä½œç¬¦ç¡®ä¿å®‰å…¨**
   - é¿å… null/undefined å¯¼è‡´çš„é”™è¯¯
   - å³ä½¿è·å–å¤±è´¥ä¹Ÿæœ‰é»˜è®¤å€¼

3. **å®Œæ•´çš„ä¿¡æ¯é“¾**
   ```
   App â†’ plugins ç®¡ç†å™¨ â†’ æ’ä»¶å®ä¾‹ â†’ settings â†’ globalTaskFilter
   ```

## å·¥ä½œæµç¨‹

### ä»»åŠ¡ä¿®æ”¹æµç¨‹
```
ç”¨æˆ·æ“ä½œï¼ˆå®Œæˆ/ä¿®æ”¹æ—¥æœŸ/å…¶ä»–ï¼‰
    â†“
updateTaskProperties (taskUpdater.ts)
    â†“
serializeTask (taskSerializer.ts) â† ä¿®å¤ç‚¹åœ¨è¿™é‡Œ
    â”œâ”€ è·å–æ’ä»¶å®ä¾‹å’Œå…¨å±€è¿‡æ»¤ç¬¦å· â† æ”¹è¿›çš„è·å–é€»è¾‘
    â”œâ”€ æ„å»ºä»»åŠ¡å±æ€§ï¼ˆå¤é€‰æ¡†ã€æè¿°ã€ä¼˜å…ˆçº§ã€æ—¥æœŸç­‰ï¼‰
    â”œâ”€ **æ·»åŠ å…¨å±€è¿‡æ»¤ç¬¦å·** â† å…³é”®æ­¥éª¤
    â””â”€ è¿”å›å®Œæ•´çš„åºåˆ—åŒ–ä»»åŠ¡å†…å®¹
    â†“
updateTaskLine (taskUpdater.ts)
    â”œâ”€ æ‹¼æ¥ï¼šç¼©è¿› + åˆ—è¡¨æ ‡è®° + åºåˆ—åŒ–å†…å®¹
    â””â”€ å†™å›æ–‡ä»¶
```

### å…³é”®ä¿®å¤ç‚¹ï¼štaskSerializer.ts ç¬¬ 156-160 è¡Œ
```typescript
// æ”¹è¿›çš„æ’ä»¶å®ä¾‹è·å–é€»è¾‘
const ganttPlugin = (app as any).plugins?.plugins?.['obsidian-gantt-calendar'] || 
                    (app as any).plugins?.getPlugin?.('obsidian-gantt-calendar');
const globalFilter = ganttPlugin?.settings?.globalTaskFilter || '';
const taskStatuses = ganttPlugin?.settings?.taskStatuses || DEFAULT_TASK_STATUSES;
```

è¿™ç¡®ä¿äº†æ— è®º Obsidian çš„æ’ä»¶ç®¡ç†å™¨å¦‚ä½•å®ç°ï¼Œæˆ‘ä»¬éƒ½èƒ½è·å–åˆ°ï¼š
- å…¨å±€è¿‡æ»¤ç¬¦å· (`globalTaskFilter`)
- ä»»åŠ¡çŠ¶æ€é…ç½® (`taskStatuses`)

## åç»­æ£€æŸ¥äº‹é¡¹

åœ¨ä»»åŠ¡ä¿®æ”¹æ—¶ï¼Œåºåˆ—åŒ–å‡½æ•°ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºæ„å»ºä»»åŠ¡è¡Œï¼š

```
[å¤é€‰æ¡†] [å…¨å±€è¿‡æ»¤ç¬¦å·] [æ ‡ç­¾] [ä»»åŠ¡æè¿°] [ä¼˜å…ˆçº§emoji] [æ—¥æœŸå­—æ®µ...]
```

ä¾‹å¦‚ï¼š
- **è¾“å…¥**: task å¯¹è±¡ + ä¿®æ”¹æ›´æ–°
- **åºåˆ—åŒ–è¿‡ç¨‹**:
  1. âœ“ è·å–å…¨å±€è®¾ç½®ä¸­çš„ globalFilterï¼ˆä¿®å¤åå¯é è·å–ï¼‰
  2. âœ“ æ ¹æ®ä»»åŠ¡çŠ¶æ€ç¡®å®šå¤é€‰æ¡†ç¬¦å· [x] / [ ] / [-] ç­‰
  3. âœ“ æ·»åŠ å…¨å±€è¿‡æ»¤ç¬¦å· `ğŸ¯ `
  4. âœ“ æ·»åŠ æ ‡ç­¾ã€æè¿°ã€ä¼˜å…ˆçº§ã€æ—¥æœŸç­‰
- **è¾“å‡º**: å®Œæ•´çš„ä»»åŠ¡è¡Œæ–‡æœ¬ï¼ŒåŒ…å«å…¨å±€è¿‡æ»¤ç¬¦å·

## éªŒè¯ä¿®å¤

æ„å»ºçŠ¶æ€ï¼šâœ… **æˆåŠŸ**

ä¿®å¤åçš„è¡Œä¸ºéªŒè¯ï¼š
1. **ç‚¹å‡»å®Œæˆä»»åŠ¡** â†’ åºåˆ—åŒ–æ—¶æ­£ç¡®è·å– globalFilter â†’ å†™å›æ–‡ä»¶æ—¶ä¿ç•™ `ğŸ¯ ` âœ“
2. **ç”˜ç‰¹å›¾æ‹–æ‹½ä¿®æ”¹æ—¥æœŸ** â†’ åºåˆ—åŒ–æ—¶æ­£ç¡®è·å– globalFilter â†’ å†™å›æ–‡ä»¶æ—¶ä¿ç•™ `ğŸ¯ ` âœ“
3. **å…¶ä»–ä»»åŠ¡ä¿®æ”¹** â†’ é€šè¿‡ updateTaskProperties â†’ serializeTask â†’ ä¿ç•™ globalFilter âœ“

## ä»£ç å˜æ›´æ€»ç»“

| æ–‡ä»¶ | è¡Œå· | å˜æ›´ | æ•ˆæœ |
|------|------|------|------|
| `src/tasks/taskSerializer.ts` | 156-160 | æ”¹è¿›æ’ä»¶å®ä¾‹è·å–é€»è¾‘ï¼Œå¢åŠ å¤‡ç”¨è·¯å¾„ | ç¡®ä¿æ­£ç¡®è·å–å…¨å±€è¿‡æ»¤ç¬¦å·è®¾ç½® |

## æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆä¸åœ¨ GCTask ä¸­å­˜å‚¨ globalFilterï¼Ÿ
- âœ“ globalFilter æ˜¯**å…¨å±€é…ç½®**ï¼Œå…¨æ’ä»¶åªæœ‰ä¸€ä¸ªå€¼
- âœ“ ä¸åº”è¯¥æŒ‰ä»»åŠ¡å­˜å‚¨é‡å¤æ•°æ®
- âœ“ åœ¨ä»»åŠ¡ä¿®æ”¹æ—¶ï¼Œåº”è¯¥æ€»æ˜¯ä½¿ç”¨å½“å‰çš„å…¨å±€è®¾ç½®
- âœ“ è¿™æ ·å¦‚æœç”¨æˆ·ä¿®æ”¹äº†å…¨å±€è®¾ç½®ï¼Œæ‰€æœ‰æ–°ä¿®æ”¹çš„ä»»åŠ¡éƒ½ä¼šä½¿ç”¨æ–°çš„è¿‡æ»¤ç¬¦å·

### ä¸ºä»€ä¹ˆç›´æ¥ä» app ä¸­è·å–è€Œä¸æ˜¯é€šè¿‡å‚æ•°ä¼ é€’ï¼Ÿ
- âœ“ ä¿æŒç°æœ‰ API å…¼å®¹æ€§
- âœ“ `updateTaskProperties` å‡½æ•°å·²ç»æœ‰ `app` å‚æ•°
- âœ“ æ— éœ€ä¿®æ”¹å¤šä¸ªå‡½æ•°ç­¾å
- âœ“ åªéœ€æ”¹è¿›åœ¨ serializeTask ä¸­è·å–æ’ä»¶çš„æ–¹å¼

