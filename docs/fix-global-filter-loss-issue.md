# ä¿®å¤å…¨å±€è¿‡æ»¤ç¬¦å·ä¸¢å¤±é—®é¢˜

## é—®é¢˜æè¿°

å½“ç”¨æˆ·ç‚¹å‡»ä»»åŠ¡å¡ç‰‡å®Œæˆä»»åŠ¡ã€æˆ–åœ¨ç”˜ç‰¹å›¾ä¸­æ‹–åŠ¨ä»»åŠ¡æ¡ä¿®æ”¹ä»»åŠ¡æ—¶é—´æ—¶ï¼Œä»»åŠ¡ä¼šé€šè¿‡ `updateTaskProperties` å‡½æ•°é‡æ–°æ„å»ºã€‚ä½†é‡å»ºåçš„ä»»åŠ¡**ä¼šä¸¢å¤±å…¨å±€è¿‡æ»¤ç¬¦å·**ã€‚

### é—®é¢˜ç°è±¡
- **åŸå§‹ä»»åŠ¡**ï¼š`- [ ] ğŸ¯ å®Œæˆé¡¹ç›®æ–‡æ¡£ ğŸ“… 2025-01-15`
- **ä¿®æ”¹å**ï¼š`- [ ] å®Œæˆé¡¹ç›®æ–‡æ¡£ ğŸ“… 2025-01-15` ï¼ˆå…¨å±€è¿‡æ»¤ç¬¦å· `ğŸ¯ ` ä¸¢å¤±ï¼‰

## æ ¹æœ¬åŸå› 

é—®é¢˜åœ¨äºä»»åŠ¡å¤„ç†æµç¨‹ä¸­çš„ä¿¡æ¯ä¸¢å¤±ï¼š

1. **è§£æé˜¶æ®µ**ï¼ˆtaskParser/main.tsï¼‰
   - åŸå§‹ä»»åŠ¡è¡Œä¸­çš„ globalFilterï¼ˆ`ğŸ¯ `ï¼‰è¢«é€šè¿‡ `removeGlobalFilter` å‡½æ•°**ç§»é™¤**
   - åªå­˜å‚¨åˆ° `task.content` ä¸­ï¼ˆä¸åŒ…å«è¿‡æ»¤ç¬¦å·çš„å†…å®¹ï¼‰
   - **æœªä¿å­˜** globalFilter çš„å…·ä½“å€¼

2. **ä¿å­˜é˜¶æ®µ**ï¼ˆtaskSerializer.tsï¼‰
   - `serializeTask` å‡½æ•°ä»**æ’ä»¶å…¨å±€è®¾ç½®**ä¸­è¯»å– `globalTaskFilter`
   - è¿™é‡Œæœ‰é—®é¢˜ï¼šç”¨æˆ·å¯èƒ½åªåœ¨æŸäº›ä»»åŠ¡è¡Œå®šä¹‰äº†è¿‡æ»¤ç¬¦å·ï¼Œè€Œå…¨å±€è®¾ç½®å¯èƒ½æ˜¯ç©ºçš„æˆ–ä¸åŒçš„å€¼
   - æ— æ³•çŸ¥é“åŸå§‹ä»»åŠ¡çš„å…·ä½“è¿‡æ»¤ç¬¦å·æ˜¯ä»€ä¹ˆ

3. **ç»“æœ**
   - å¦‚æœå…¨å±€è®¾ç½®ä¸­æ²¡æœ‰å®šä¹‰ `globalTaskFilter`ï¼Œé‡å»ºçš„ä»»åŠ¡å°±ä¼šä¸¢å¤±è¿‡æ»¤ç¬¦å·
   - å³ä½¿æœ‰å…¨å±€è®¾ç½®ï¼Œé‡å»ºçš„ä»»åŠ¡ä¹Ÿå¯èƒ½ä¸æ˜¯åŸå§‹çš„é‚£ä¸ªç¬¦å·ï¼ˆå¦‚æœç”¨æˆ·æ”¹äº†è®¾ç½®ï¼‰

## è§£å†³æ–¹æ¡ˆ

é€šè¿‡ 3 ä¸ªæ–‡ä»¶çš„ä¿®æ”¹ï¼Œå»ºç«‹**ä»»åŠ¡çº§åˆ«çš„ globalFilter å­˜å‚¨**ï¼š

### 1. types.ts - æ·»åŠ å­—æ®µåˆ° GCTask æ¥å£

**å˜æ›´**ï¼šåœ¨ GCTask æ¥å£ä¸­æ·»åŠ  `globalFilter` å­—æ®µç”¨äºä¿å­˜åŸå§‹è¿‡æ»¤ç¬¦å·

```typescript
export interface GCTask {
    filePath: string;
    fileName: string;
    lineNumber: number;
    content: string;
    description: string;
    globalFilter?: string;  // â† æ–°å¢ï¼šä¿å­˜å…¨å±€è¿‡æ»¤ç¬¦å·
    completed: boolean;
    // ... å…¶ä»–å­—æ®µ
}
```

### 2. taskParser/main.ts - è§£ææ—¶ä¿å­˜ globalFilter

**å˜æ›´**ï¼šåœ¨ä»»åŠ¡å¯¹è±¡åˆå§‹åŒ–æ—¶ï¼Œä¿å­˜ä»åŸå§‹ä»»åŠ¡è¡Œä¸­æå–çš„ globalFilter

```typescript
const task: GCTask = {
    filePath: file.path,
    fileName: file.basename,
    lineNumber: lineNumber + 1,
    content: contentWithoutFilter,
    description: extractTaskDescription(contentWithoutFilter),
    globalFilter: globalTaskFilter,  // â† æ–°å¢ï¼šä¿å­˜è¿‡æ»¤ç¬¦å·
    completed,
    cancelled,
    status,
    priority: 'normal',
};
```

**å·¥ä½œæµç¨‹**ï¼š
- å½“ä»»åŠ¡è¢«è§£ææ—¶ï¼Œ`globalTaskFilter` å˜é‡åŒ…å«äº†å½“å‰çš„å…¨å±€è¿‡æ»¤ç¬¦å·
- å°†å…¶ä¿å­˜åˆ°ä»»åŠ¡å¯¹è±¡ä¸­ï¼Œä»¥ä¾¿åç»­é‡å»ºæ—¶ä½¿ç”¨
- è¿™æ ·å°±ä¿ç•™äº†ä»»åŠ¡è¢«è§£ææ—¶çš„è¿‡æ»¤ç¬¦å·ä¸Šä¸‹æ–‡

### 3. taskSerializer.ts - ä¼˜å…ˆä½¿ç”¨ä»»åŠ¡çš„ globalFilter

**å˜æ›´**ï¼šåœ¨åºåˆ—åŒ–ä»»åŠ¡æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ä»»åŠ¡å¯¹è±¡ä¸­ä¿å­˜çš„ globalFilterï¼Œè€Œä¸æ˜¯æ€»æ˜¯ä»å…¨å±€è®¾ç½®è¯»å–

```typescript
// ä¼˜å…ˆä½¿ç”¨ä»»åŠ¡ä¸­ä¿å­˜çš„ globalFilterï¼Œå¦‚æœä»»åŠ¡ä¸­æ²¡æœ‰åˆ™ä½¿ç”¨å…¨å±€è®¾ç½®
const globalFilter = task.globalFilter ?? defaultGlobalFilter;
```

**é€»è¾‘**ï¼š
- `task.globalFilter` ä¼˜å…ˆçº§æœ€é«˜ï¼ˆä»»åŠ¡çº§åˆ«ï¼‰
- å¦‚æœä»»åŠ¡ä¸­æ²¡æœ‰ï¼ˆæ—§ä»»åŠ¡å…¼å®¹æ€§ï¼‰ï¼Œæ‰ä½¿ç”¨ `defaultGlobalFilter`ï¼ˆå…¨å±€è®¾ç½®çº§åˆ«ï¼‰
- è¿™ç¡®ä¿äº†æ–°åˆ›å»ºæˆ–ä¿®æ”¹çš„ä»»åŠ¡éƒ½èƒ½æ­£ç¡®ä¿ç•™åŸå§‹è¿‡æ»¤ç¬¦å·

## ä¿®å¤æ•ˆæœéªŒè¯

### åœºæ™¯ 1ï¼šç‚¹å‡»ä»»åŠ¡å¡ç‰‡å®Œæˆä»»åŠ¡
1. ç”¨æˆ·åœ¨ä»»åŠ¡è§†å›¾ä¸­ç‚¹å‡»å¤é€‰æ¡†å®Œæˆä»»åŠ¡
2. è§¦å‘ `updateTaskCompletion` â†’ `updateTaskProperties`
3. ä»»åŠ¡è¢«åºåˆ—åŒ–å¹¶å†™å›æ–‡ä»¶
4. **ä¿®å¤å‰**ï¼šä¸¢å¤± globalFilter
5. **ä¿®å¤å**ï¼šâœ“ ä¿ç•™ globalFilter

### åœºæ™¯ 2ï¼šç”˜ç‰¹å›¾ä¸­æ‹–æ‹½ä¿®æ”¹ä»»åŠ¡æ—¥æœŸ
1. ç”¨æˆ·åœ¨ç”˜ç‰¹å›¾ä¸­æ‹–æ‹½ä»»åŠ¡æ¡åˆ°æ–°æ—¥æœŸ
2. è§¦å‘æ—¥æœŸä¿®æ”¹å›è°ƒ â†’ `updateTaskDateField` â†’ `updateTaskProperties`
3. ä»»åŠ¡è¢«åºåˆ—åŒ–å¹¶å†™å›æ–‡ä»¶
4. **ä¿®å¤å‰**ï¼šä¸¢å¤± globalFilter
5. **ä¿®å¤å**ï¼šâœ“ ä¿ç•™ globalFilter

### åœºæ™¯ 3ï¼šå…¼å®¹æ€§æµ‹è¯•
- **æ–°ä»»åŠ¡**ï¼šé€šè¿‡è§£æå¾—åˆ° globalFilterï¼Œå­˜å‚¨åœ¨ä»»åŠ¡å¯¹è±¡ä¸­ï¼Œé‡å»ºæ—¶æ­£ç¡®ä½¿ç”¨ âœ“
- **æ—§ä»»åŠ¡**ï¼ˆä»å¤‡ä»½æ¢å¤ç­‰ï¼‰ï¼štask.globalFilter ä¸º undefinedï¼Œé™çº§ä½¿ç”¨å…¨å±€è®¾ç½® âœ“
- **ä¿®æ”¹å…¨å±€è®¾ç½®**ï¼šæ–°è§£æçš„ä»»åŠ¡ä½¿ç”¨æ–°è®¾ç½®ï¼Œä½†å·²å­˜åœ¨çš„ä»»åŠ¡ä¿ç•™åŸå§‹ç¬¦å· âœ“

## æ¶‰åŠçš„è°ƒç”¨é“¾

```
ç”¨æˆ·æ“ä½œï¼ˆå®Œæˆä»»åŠ¡/æ‹–æ‹½ä¿®æ”¹ï¼‰
    â†“
updateTaskCompletion / updateTaskDateField / updateTaskProperties
    â†“
serializeTask (æ ¸å¿ƒä¿®å¤ç‚¹)
    â†“
æ–‡ä»¶å†™å›
```

æ‰€æœ‰æ¶‰åŠä»»åŠ¡ä¿®æ”¹çš„åœ°æ–¹éƒ½é€šè¿‡ `updateTaskProperties` ç»Ÿä¸€å¤„ç†ï¼Œå› æ­¤è¿™ä¸ªä¿®å¤è‡ªåŠ¨é€‚ç”¨äºæ‰€æœ‰åœºæ™¯ã€‚

## ä»£ç å˜æ›´æ€»ç»“

| æ–‡ä»¶ | å˜æ›´ | ç›®çš„ |
|------|------|------|
| `src/types.ts` | æ·»åŠ  `globalFilter?: string` å­—æ®µ | å­˜å‚¨è¿‡æ»¤ç¬¦å· |
| `src/tasks/taskParser/main.ts` | åˆå§‹åŒ–æ—¶èµ‹å€¼ `globalFilter: globalTaskFilter` | è§£ææ—¶ä¿å­˜è¿‡æ»¤ç¬¦å· |
| `src/tasks/taskSerializer.ts` | ä½¿ç”¨ `task.globalFilter ?? defaultGlobalFilter` | é‡å»ºæ—¶ä¼˜å…ˆä½¿ç”¨ä»»åŠ¡çš„è¿‡æ»¤ç¬¦å· |

## æ„å»ºçŠ¶æ€

âœ“ TypeScript ç¼–è¯‘æˆåŠŸï¼ˆ0 errorsï¼‰
âœ“ æ‰“åŒ…æˆåŠŸ
âœ“ æ–‡ä»¶åŒæ­¥æˆåŠŸ
